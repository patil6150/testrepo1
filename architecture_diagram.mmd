graph TB
    subgraph OnPremise["ğŸ¢ ON-PREMISE ENVIRONMENT"]
        subgraph AppLayer["Application Layer"]
            LegacyApp["Legacy Customer<br/>Onboarding Application<br/>ğŸ–¥ï¸ Windows Server"]
        end
        
        subgraph DataLayer["Database Layer"]
            SQLServer["SQL Server 2019<br/>ğŸ’¾ Database<br/>IP: 10.10.10.50<br/>Port: 1433<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ” Auth Methods:<br/>âœ“ SQL Server Auth<br/>âœ“ Windows Auth<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Size: 2-3 TB<br/>Tables: 100+<br/>CDC Enabled"]
        end
        
        subgraph StorageLayer["Storage Layer"]
            NAS["NAS/SAN File Server<br/>ğŸ“ Network Storage<br/>IP: 10.10.10.200<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ” Protocols:<br/>âœ“ NFS (Port 2049)<br/>âœ“ SMB/CIFS (Port 445)<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Auth: Active Directory<br/>Size: 2-3 TB<br/>Files: Documents, Images, PDFs"]
        end
        
        subgraph AuthLayer["Authentication & Identity"]
            AD["Active Directory<br/>ğŸ”‘ Domain Controller<br/>IP: 10.10.10.10<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Services:<br/>âœ“ LDAP (Port 389)<br/>âœ“ LDAPS (Port 636)<br/>âœ“ Kerberos (Port 88)<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Domain: COMPANY.LOCAL<br/>Users: Corporate Authentication"]
        end
        
        subgraph MigrationTools["Migration Tools (On-Premise)"]
            DSAgent["AWS DataSync Agent<br/>ğŸ”„ VM Appliance<br/>IP: 10.10.10.100<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Platform:<br/>âœ“ VMware ESXi / Hyper-V<br/>Resources: 4 vCPU, 32GB RAM<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Connects To:<br/>â†’ NAS (NFS/SMB)<br/>â†’ AWS DataSync Service<br/>â†’ Amazon S3"]
        end
        
        subgraph NetworkSec["Network Security"]
            Firewall["Corporate Firewall<br/>ğŸ›¡ï¸ Security Gateway<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Outbound Rules:<br/>âœ“ UDP 500, 4500 (IPSec)<br/>âœ“ TCP 443 (HTTPS)<br/>âœ“ Allow to AWS endpoints"]
        end
    end
    
    subgraph Connectivity["ğŸŒ SECURE CONNECTIVITY LAYER"]
        subgraph VPNOption["Option 1: Site-to-Site VPN"]
            VPN["AWS VPN Connection<br/>ğŸ” IPSec Tunnel<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Protocol: IPSec<br/>Encryption: AES-256<br/>Key Exchange: IKEv2<br/>Tunnels: Dual (HA)<br/>Routing: BGP<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Latency: 20-50ms<br/>Bandwidth: 1.25 Gbps max"]
        end
        
        subgraph DXOption["Option 2: Direct Connect (Recommended)"]
            DX["AWS Direct Connect<br/>âš¡ Dedicated Fiber<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Speed: 10 Gbps<br/>Protocol: 802.1Q VLAN<br/>Routing: BGP<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Latency: < 10ms<br/>Dedicated bandwidth<br/>Consistent performance"]
        end
    end
    
    subgraph AWSCloud["â˜ï¸ AWS CLOUD ENVIRONMENT"]
        subgraph NetworkLayer["VPC Network Layer"]
            VPC["Amazon VPC<br/>ğŸ—ï¸ Virtual Private Cloud<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>CIDR: 10.0.0.0/16<br/>Region: us-east-1<br/>AZs: Multi-AZ deployment"]
            
            VGW["Virtual Private Gateway<br/>ğŸšª VPN/DX Entry Point<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Attached to VPC<br/>BGP ASN: 65000"]
            
            subgraph Subnets["VPC Subnets"]
                PrivSubnet1["Private Subnet 1<br/>10.0.1.0/24<br/>AZ: us-east-1a"]
                PrivSubnet2["Private Subnet 2<br/>10.0.2.0/24<br/>AZ: us-east-1b"]
                DBSubnet1["DB Subnet 1<br/>10.0.11.0/24<br/>AZ: us-east-1a"]
                DBSubnet2["DB Subnet 2<br/>10.0.12.0/24<br/>AZ: us-east-1b"]
            end
            
            SG["Security Groups<br/>ğŸ”’ Virtual Firewalls<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>DMS-SG:<br/>  In: 1433 from On-Prem<br/>  Out: 5432 to RDS<br/>RDS-SG:<br/>  In: 5432 from DMS/Pega<br/>S3-Endpoint-SG:<br/>  In: 443 from DataSync"]
            
            NACL["Network ACLs<br/>Subnet-level filtering"]
        end
        
        subgraph MigrationServices["Migration Services Layer"]
            DMS["AWS Database Migration Service<br/>ğŸ”„ DMS Replication Instance<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Instance: r5.4xlarge<br/>vCPU: 16 | RAM: 128 GB<br/>Storage: 1 TB (auto-scaling)<br/>Deployment: Multi-AZ<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Source Endpoint:<br/>  Engine: sqlserver<br/>  Host: 10.10.10.50:1433<br/>  ğŸ” Auth: SQL Server Auth<br/>  User: dms_migration_user<br/>  SSL: Required (TLS 1.2+)<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Target Endpoint:<br/>  Engine: postgres<br/>  Host: pega-db.xxx.rds...<br/>  Port: 5432<br/>  ğŸ” Auth: PostgreSQL + SSL<br/>  User: pegaadmin<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Migration Task:<br/>  Mode: Full Load + CDC<br/>  Threads: 16 parallel<br/>  Validation: Enabled"]
            
            DataSync["AWS DataSync Service<br/>ğŸ“¤ File Transfer Service<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Source Location:<br/>  Type: NFS/SMB<br/>  Agent: agent-abc123<br/>  Path: /customer-docs<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Destination:<br/>  Type: S3<br/>  Bucket: pega-documents<br/>  ğŸ” Auth: IAM Role<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Transfer Options:<br/>  Mode: Incremental<br/>  Verification: Checksums<br/>  Preserve: Metadata"]
        end
        
        subgraph DatabaseLayer["Database Layer"]
            RDS["Amazon RDS PostgreSQL<br/>ğŸ’¾ Managed Database<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Instance: db.r6g.4xlarge<br/>vCPU: 16 | RAM: 128 GB<br/>Storage: 7.5 TB (auto-scale)<br/>IOPS: 30,000 provisioned<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Deployment: Multi-AZ<br/>Primary: us-east-1a<br/>Standby: us-east-1b<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ” Authentication:<br/>âœ“ PostgreSQL Native Auth<br/>âœ“ IAM Database Auth<br/>âœ“ SSL/TLS Certificates<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Encryption:<br/>  At Rest: KMS (AES-256)<br/>  In Transit: TLS 1.2+<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Backups:<br/>  Automated: Daily<br/>  Retention: 30 days<br/>  Manual: Pre-migration<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Engine: PostgreSQL 14.x<br/>Port: 5432"]
        end
        
        subgraph StorageLayer2["Object Storage Layer"]
            S3["Amazon S3<br/>ğŸ“¦ Object Storage<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Bucket: pega-customer-docs<br/>Region: us-east-1<br/>Size: ~3 TB (growing)<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ” Security:<br/>âœ“ Server-Side Encryption<br/>  (SSE-KMS)<br/>âœ“ Bucket Policies<br/>âœ“ IAM Policies<br/>âœ“ Versioning: Enabled<br/>âœ“ MFA Delete: Enabled<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Access Methods:<br/>  â†’ Pega Cloud (PrivateLink)<br/>  â†’ DataSync (IAM Role)<br/>  â†’ S3 API (HTTPS/443)<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Storage Classes:<br/>  â†’ Standard (hot data)<br/>  â†’ IA (archive after 90d)<br/>  â†’ Glacier (compliance)"]
            
            VPCEndpointS3["VPC Endpoint (S3)<br/>ğŸ”— Private S3 Access<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Type: Gateway Endpoint<br/>No internet required<br/>Route: VPC â†’ S3"]
        end
        
        subgraph SecurityServices["Security & Identity Services"]
            IAM["AWS IAM<br/>ğŸ‘¤ Identity & Access<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Service Roles:<br/>âœ“ DMS-Execution-Role<br/>âœ“ DataSync-S3-Role<br/>âœ“ RDS-Monitoring-Role<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Policies:<br/>âœ“ Least Privilege<br/>âœ“ MFA Required (Admin)<br/>âœ“ Resource-based policies<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Authentication:<br/>âœ“ SAML 2.0 Federation<br/>âœ“ SSO with Corp IdP"]
            
            KMS["AWS KMS<br/>ğŸ”‘ Key Management<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Customer Managed Keys:<br/>âœ“ RDS-Encryption-Key<br/>âœ“ S3-Encryption-Key<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Features:<br/>âœ“ Automatic Rotation<br/>âœ“ CloudTrail Logging<br/>âœ“ FIPS 140-2 Level 2<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Key Policy:<br/>  Grant access to:<br/>  â†’ RDS service<br/>  â†’ S3 service<br/>  â†’ Admin users"]
            
            Secrets["AWS Secrets Manager<br/>ğŸ” Credential Storage<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Stored Secrets:<br/>âœ“ SQL Server creds<br/>  (dms_migration_user)<br/>âœ“ PostgreSQL creds<br/>  (pegaadmin)<br/>âœ“ SMB credentials<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Rotation:<br/>  Automatic: Every 30 days<br/>  Lambda-based rotation<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Encryption: KMS<br/>Access: IAM policies"]
            
            CloudTrail["AWS CloudTrail<br/>ğŸ“‹ Audit Logging<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Logs:<br/>âœ“ All API calls<br/>âœ“ Console sign-ins<br/>âœ“ KMS key usage<br/>âœ“ S3 access<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Retention: 90 days<br/>Storage: S3 bucket"]
            
            PrivateLink["AWS PrivateLink<br/>ğŸ”— Private Connectivity<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Purpose:<br/>  VPC â†’ Pega Cloud<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Endpoint Type: Interface<br/>DNS: Private DNS names<br/>No Internet Gateway needed"]
        end
        
        subgraph MonitoringLayer["Monitoring & Logging"]
            CloudWatch["Amazon CloudWatch<br/>ğŸ“Š Monitoring<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Metrics:<br/>âœ“ DMS replication lag<br/>âœ“ RDS CPU/Memory/IOPS<br/>âœ“ S3 request metrics<br/>âœ“ DataSync throughput<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Alarms:<br/>âœ“ Replication lag > 10min<br/>âœ“ RDS CPU > 80%<br/>âœ“ Storage > 80%<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Logs:<br/>  â†’ Application logs<br/>  â†’ Database logs<br/>  â†’ VPC Flow Logs<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Dashboards:<br/>  Migration progress<br/>  System health"]
            
            SNS["Amazon SNS<br/>ğŸ“§ Notifications<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Topics:<br/>âœ“ Migration-Alerts<br/>âœ“ Critical-Issues<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Subscribers:<br/>  â†’ Email<br/>  â†’ SMS<br/>  â†’ Lambda"]
        end
        
        subgraph PegaPlatform["Pega Cloud Platform"]
            Pega["Pega Customer Service<br/>ğŸ¯ Application Platform<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Platform: Pega Cloud<br/>Hosting: AWS (Managed by Pega)<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Database Connection:<br/>  â†’ RDS PostgreSQL<br/>  Protocol: JDBC/PostgreSQL<br/>  Port: 5432<br/>  ğŸ” Auth: PostgreSQL + SSL<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>File Access:<br/>  â†’ S3 (via PrivateLink)<br/>  Protocol: S3 API / HTTPS<br/>  ğŸ” Auth: IAM Role<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>User Authentication:<br/>  â†’ SSO via SAML 2.0<br/>  â†’ Optional: AWS Directory<br/>    Service integration<br/>  â†’ Corporate AD federation"]
        end
    end
    
    %% Connections - Application Flow
    LegacyApp -->|Queries| SQLServer
    LegacyApp -->|File Access| NAS
    SQLServer -.->|Domain Auth| AD
    NAS -.->|Domain Auth| AD
    
    %% Connections - Migration Tools to Source
    DSAgent -->|NFS/SMB<br/>Ports: 2049, 445| NAS
    
    %% Connections - On-Prem to AWS
    SQLServer -->|SQL Server Auth<br/>User: dms_migration_user<br/>Port: 1433<br/>Protocol: TDS over TLS| Firewall
    DSAgent -->|HTTPS/443<br/>AWS Signature V4| Firewall
    
    Firewall -->|IPSec VPN<br/>AES-256| VPN
    Firewall -->|Dedicated Fiber<br/>10 Gbps| DX
    
    VPN -->|Encrypted Tunnel| VGW
    DX -->|Private VLAN| VGW
    
    %% Connections - AWS Internal Network
    VGW --> VPC
    VPC --> PrivSubnet1
    VPC --> PrivSubnet2
    VPC --> DBSubnet1
    VPC --> DBSubnet2
    
    PrivSubnet1 --> DMS
    
    %% Connections - DMS Flow
    DMS -->|Source Connection<br/>SQL Server Auth<br/>SSL/TLS| SQLServer
    DMS -->|Target Connection<br/>PostgreSQL Auth<br/>SSL/TLS<br/>Port: 5432| RDS
    
    %% Connections - DataSync Flow
    DSAgent -->|Activation & Control<br/>HTTPS/443| DataSync
    DataSync -->|S3 API<br/>IAM Role Auth<br/>HTTPS/443| VPCEndpointS3
    VPCEndpointS3 --> S3
    
    %% Connections - RDS
    RDS --> DBSubnet1
    RDS --> DBSubnet2
    
    %% Connections - Pega
    Pega -->|JDBC<br/>PostgreSQL Protocol<br/>Port: 5432<br/>SSL Auth| RDS
    Pega -->|S3 API<br/>IAM Role<br/>HTTPS/443| PrivateLink
    PrivateLink --> S3
    
    %% Connections - Security Services
    DMS -.->|Retrieve Credentials| Secrets
    DataSync -.->|Assume Role| IAM
    RDS -.->|Encryption Keys| KMS
    S3 -.->|Encryption Keys| KMS
    
    %% Connections - Monitoring
    DMS -.->|Metrics & Logs| CloudWatch
    RDS -.->|Metrics & Logs| CloudWatch
    DataSync -.->|Metrics & Logs| CloudWatch
    CloudWatch -->|Trigger Alerts| SNS
    
    %% Connections - Audit
    IAM -.->|API Logging| CloudTrail
    KMS -.->|Key Usage Logging| CloudTrail
    S3 -.->|Access Logging| CloudTrail
    
    %% Styling
    classDef onprem fill:#E8EAF6,stroke:#1E2761,stroke-width:3px,color:#000
    classDef database fill:#C8E6C9,stroke:#2E7D32,stroke-width:2px,color:#000
    classDef storage fill:#FFF9C4,stroke:#F57F17,stroke-width:2px,color:#000
    classDef network fill:#FFECB3,stroke:#FF6F00,stroke-width:2px,color:#000
    classDef security fill:#F3E5F5,stroke:#6A1B9A,stroke-width:2px,color:#000
    classDef migration fill:#E1F5FE,stroke:#01579B,stroke-width:2px,color:#000
    classDef aws fill:#E3F2FD,stroke:#1976D2,stroke-width:2px,color:#000
    classDef pega fill:#C8E6C9,stroke:#388E3C,stroke-width:3px,color:#000
    
    class SQLServer,RDS database
    class NAS,S3 storage
    class VPN,DX,VPC,VGW,Firewall network
    class IAM,KMS,Secrets,CloudTrail,AD,PrivateLink security
    class DMS,DataSync,DSAgent migration
    class Pega pega
    class CloudWatch,SNS aws
